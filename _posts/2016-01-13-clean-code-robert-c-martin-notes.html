---
layout: post
title: '"Clean Code" Robert C. Martin'
date: '2016-01-13T21:50:00.001+01:00'
author: Monik
tags:
- Programming
- Code Design
modified_time: '2016-05-27T10:44:44.317+02:00'
thumbnail: https://1.bp.blogspot.com/-sPTePip1-4Y/VpfEAGRrCwI/AAAAAAAACVE/f634aJu_RYk/s72-c/dirty%2Btests.png
blogger_id: tag:blogger.com,1999:blog-5940427300271272994.post-6637473164435863327
blogger_orig_url: http://learningmonik.blogspot.com/2016/01/clean-code-robert-c-martin-notes.html
commentIssueId: 27
---

<div dir="ltr" style="text-align: left;" trbidi="on"><span style="font-family: inherit;">These are the notes I took while reading the book <a href="https://books.google.de/books/about/Clean_Code.html?id=dwSfGQAACAAJ">"Clean Code: A Handbook of Agile Software Craftsmanship" (Robert C. Martin)</a>, that are supposed to summarize the main concepts presented in the book.</span><br /><span style="font-family: inherit;"><br />The book has a mission to "improve the state of software craftmanship". A lot of reasoning and moralizing at the beginning, I'll skip that (still it is really worth reading!) :) What I liked the most:</span><br /><blockquote class="tr_bq"><i><span style="font-family: inherit;"><span style="background-color: white; line-height: 18.2px;">We want to use the popular paperback</span><span style="background-color: white; line-height: 18.2px;">&nbsp;model whereby the author is responsible for making himself clear and not the academic model where it is the scholar's job to dig the meaning out of the paper.</span></span></i></blockquote>Just gonna mention that all the advice comes not from guesses but experience (as the author&nbsp;claims).<br /><br /><h3 style="text-align: left;">Dictionary</h3><div style="text-align: left;">Because I hate getting stuck on abbreviations:</div><div style="text-align: left;"></div><ul style="text-align: left;"><li><b>OCP</b> - Open-Closed Principle - <i>Classes should be open for extension but closed for modification.</i></li><li><b>SRP </b>- Single Responsibility Principle -&nbsp;<i>A class or module should have one, and only one, reason to change.</i></li><li><b>DIP -</b>&nbsp;Dependency Inversion Principle - <i>C</i><i>lasses should depend upon abstractions, not on concrete details.</i></li></ul>[note that I skipped the first chapter, so the numbering of chapters is shifted by -1]<br /><h3>1. Meaningful Names</h3><div><b>Variable name</b>&nbsp;should say <b>what is being measured </b>and the <b>unit of measurement</b>, e.g. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[int elapsedTimeInDays]&nbsp;</span><span style="font-family: inherit;">instead of </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;[int i]</span>.</div><div><br /></div><div>It is always useful to add the <b>context </b>to the variable names, e.g.<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [gameBoard] </span>instead of <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[theList]</span>. Also the whole class is a context to their variables/methods.</div><div><br /></div><div>It is sometimes a good idea to extract even one-line-if-condition to a <b>separate method</b>, as one can give this method a more descriptive&nbsp;<b>name</b>.</div><div><br /></div><div>It is important to keep in mind the <b>keywords </b>specific to different areas of IT, and <b>avoid </b>using them when we mean them in a different <b>context</b>. E.g. do not call <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[accountList]</span> something which is not a list.</div><div><br /></div><div>Do not use names that differ only <b>sligthly</b>, for example<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [XYZControllerForEfficientHandlingOfStrings] </span>and<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [XYZControllerForEfficientStorageOfStrings]</span>.</div><div><br /></div><div>Do not use lowercase L together with uppercase O, as this will look like number "10". Just <b>don't be confusing </b>when you don't have to.</div><div><br /></div><div><b>Avoid </b>using <b>noise words</b>, like <i>a</i>, <i>an</i>, <i>the</i>, <i>info</i>, <i>data</i>,... to "make up" a new, non-conflicting name. For example would you be able to guess the difference between<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [ProductInfo] </span>and<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [ProductData]</span>?</div><div><br /></div><div>Make your names <b>pronouncable,</b> so that you can later discuss the code without sounding like an idiot.</div><div><br /></div><div>Make your variable names be <b>easy to find via a text search </b>- makes your life easier.</div><i><br /></i>Better add <b>suffixes </b>to interface <b>implementations</b> than <b>prefixes </b>to the <b>interface </b>name. No one needs to know that e.g.<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [ShapeFactory] </span>is an interface, it's less ugly to name its implementation<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [ShapeFactoryImpl]</span>.<br /><br /><b>Class names </b>should have a <b>noun </b>in the name.<br /><br />It is better to have <b>factory methods </b>and private constructors, than a big amount of overloaded constructors - because the factory methods can have descriptive&nbsp;<b>names</b>.<br /><br /><b>Don't try to be funny </b>when choosing names (someone may not understand).<br /><br />Use <b>consistent lexicon</b>, e.g. <i>get</i>, <i>fetch</i>, <i>retrieve</i> - <b>decide on one word </b>to use per project, not per developer. Or same with <i>manager </i>vs <i>controller vs driver</i>.<br /><blockquote class="tr_bq">[BUT] be aware to use one word <b>only when semantics </b>are same - for example <i>adding</i> two strings together is not same as <i>adding </i>an element to a list. Then you have to use a different name.</blockquote><br /><b>Problem domain </b>(e.g. customer, account)&nbsp;vs <b>solution domain</b> (e.g. visitor, queue) terms - first try to use solution domain, then problem domain. The more code has to do with the solution domain problems, the more solution domain vocabulary it should use, and vice versa. It is important to <b>know the difference</b>.<br /><i><br /></i><b>Prefixing everything with same prefix </b>may not be a good idea - as it makes it harder to use code completion. Why to work against your tools? <b>Add no more context to the name than neccessary</b>.<br /><br />Don't be afraid of <b>renaming</b>.<br /><br /><h3>2. Functions</h3>Should be <b>smaller than small</b>. Best 3-4 <b>lines</b>. Max 1-2 <b>indent levels</b> (e.g. "if").<br /><br />Each function should do only&nbsp;<b>one thing</b>. "One thing" is when you cannot split it to steps anymore.<br /><br /><b>Mixing levels of abstraction</b> within one function is always confusing, e.g.<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [getHtml()] </span>next to<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [.append("\n")]</span>.<br /><br />The code should be read like a top-down narrative. Place the extracted function <b>right below </b>the function that is calling it.<br /><br />Sometimes it's worth to use <b>polymorphism rather than a switch</b>. Using switch often breaks the SRP (more than one reason to change) and OCP (must change whenver new types are added), and sometimes even causes <b>duplicating </b>the same switch costructions in several functions. Instead create classes for each <b>switch </b>case, and bury the switch itself deep in an <b>Abstract Factory</b>.<br /><br />Max number of <b>function input arguments </b>is 2-3, best 0. They increase <b>testing complexity</b>. Make the function harder to understand.<br /><blockquote class="tr_bq">Using 2 arguments is only justified for example in situations like<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [new Point(0,0)]</span>, because a point has 2 <b>ordered </b>coordinates. If there is no <b>natural cohesion or ordering </b>between arguments they should not be both input arguments of a function. E.g. the<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [.assertEquals(expected, actual)]</span> is confusing, isn't it. And&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[.assertEquals(message, expected, actual)]&nbsp;</span>is even more confusing - how many times you had to check the signature first?&nbsp;</blockquote>Often if a function takes many arguments it's a sign that they should be&nbsp;<b>wrapped into a class on their own</b>.<br /><br />Anything that forces you to <b>look up a function signature</b> is a <b>cognitive break </b>and should be avoided.<br /><br />Avoid using <b>flag arguments</b>. Boolean passed into a fuction means the fuction does <b>more than one thing</b>! Should be split into two functions then.<br /><br />Have no <b>side effects in </b>a function&nbsp;- they are evil. They may introduce <b>temporal coupling</b> (temporal - related to time), e.g. by hiddenly calling<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [initialize()]</span>.<br /><br />Try not to use <b>input arguments as output</b>. Better use<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [report.addFooter()] </span>than<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [.addFooter(report)] </span><span style="font-family: inherit;">- that is more OO style.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Apply <b>Command Query Separation </b>- a function either <b>does something </b>or <b>answers a question</b>, not both. E.g.&nbsp;</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[boolean setName(name)]</span><span style="font-family: inherit;">&nbsp;is bad, as it requires guessing what the returned value means. This should be separated into two functions.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">It's a good practice to <b>extract the bodies of try-catch blocks into separate methods </b>- to separate the <b>logic </b>from <b>error handling</b>. Error handling is already a <b>one thing</b>.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Start with writing any fuction and then <b>refactor</b> it, long. It's not the goal to have them neat and nice from the start.</span><br /><br /><h3 style="text-align: left;">3. Comments</h3><div><i>Don't comment on bad code - rewrite it.</i></div><div><br /></div><div>Comments are evil. <i>The goal of comments is to compensate for our failure or to help express ourselves better. </i>They are always sign of <b>failure</b>.</div><div><br /></div><div>Comments <b>get outdated </b>as there is no good way of maintaining them. People move the code but forget the comment. People change the code but forget the comment, or no longer remember what it was supposed to mean.</div><div><br /></div><div>They are reasonable only sometimes (express rationale behind choosing a certain approach, or to stress out some important detail in the implementation), but in general try to <b>minimize </b>using them.</div><div><br /></div><div>Of course it's different with Javadocs, <b>Javadocs are useful</b>, but keep them <b>accurate</b>. <b>Misleading</b> comment is worse than no comment.</div><div><br />If you write a comment, write&nbsp;<b>about what is just next to it, not about the whole system around</b>. Only about what the function has control over. Otherwise it will soon become outdated, and therefore misleading.<br /><br /></div><div>No point in writing sth like&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[/* Returns the name. */ getName()]</span>.</div><div><br /></div><div>Using <b>HTML </b>in comments makes them <b>harder to be read in IDE </b>- so where they are read the most.</div><div><br /></div><div><h3 style="text-align: left;">4. Formatting</h3></div><div><b>Code formatting </b>is important because it is part of <b>communication</b>.&nbsp;</div><div><br /></div><div>It also makes the reader trust the code more.</div><div><br /></div><div><b>Vertical size </b>of a file should be typically <b>200 lines</b>, with upper limit of 500 (but this is just a rough number, based on a number of open source projects; the author phrases it way more dyplomatically :P).</div><div><br /></div><div><b>Newspaper metaphor </b>- code should read like a newspaper article. First the title, then the introduction, only later the details. Name should be simple but explanatory. The article should be short enough to make it attractive to read.</div><div><br /></div><div>It's a good idea to put a&nbsp;<b>blank line&nbsp;</b>between groups of lines that represent single thought. And lines referring to single concept should be kept <b>dense</b>.</div><div><br /></div><div>Keep <b>related pieces close to each other </b>- e.g. functions one after another, in one file. That's why <b>protected </b>variables should be avoided.</div><br />Declare <b>local variables on the top </b>of each function (except when it's just a loop counter, or sth similar).<br /><br /><b>Instance variables and constants </b>shoud also be <b>at the top of </b>the class, even if a constant is used only in one place later - as at the top it is more <b>visible</b>.<br /><br />Keep <b>lines short</b>, less than 80-120 characters. Even if your screen can fit more.<br /><br />Surround "=" assignments with <b>whitespaces</b>, to <b>accentuate </b>them.<br /><br />[some other obvious whitespace usages and antiusages]<br /><br />Keep <b>indentation</b>. Even for one line "if"s, one line "while"s - expand them into multiline and add indent. Dont do<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [while();]</span>, in one line (notice the semicolon), this is evil.<br /><br />Each developer should follow <b>common team rules</b>, even if some of them don't like some of them.<br /><br /><h3 style="text-align: left;">5. Objects and Data Structures</h3><b>Don't automatically add getters and setters </b>to each private variable. Why would we have private variables at all then?<br /><blockquote class="tr_bq">For example a Point - can be defined by<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [x,y] </span>(carthesian coordinates) or by<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> [r,theta] </span>(polar coordinates). If we don't add separate setters for <i>x, y, r, t,</i> but rather a setter for <i>x, y</i> and another setter for <i>r, t</i> - we <b>enforce an access policy</b>. And even despite having separate getters for each of <i>x, y, r, t,</i>&nbsp;we still&nbsp;<b>do not expose the internal implementation</b>.</blockquote><b>Getters and setters </b>are part of the <b>interface </b>using which the object communicates with the world. Think it through.<br /><br /><b>Object vs data structure</b> - data structure only <b>exposes it's data</b>, and object <b>exposes functions </b>that operate on its data. <b>Do not mix them </b>in one class! Do not create <b>hybrids</b>.<br /><b></b><br /><b>OO code </b>makes it easier to <b>add new classes&nbsp;</b>&nbsp;(add new objects), and <b>procedural code </b>makes it easier to <b>add new functions</b> (add new behaviour). <b>Always choose the style appropriate </b>to the task at hand. Everything <b>does not have to be an object</b>.<br /><blockquote class="tr_bq">An example of a procedural code is the following: we have a class <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Geometry]</span> and different <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Shape]</span> subclasses. In Geometry class there is a number of methods that operate on a Shape, in each there is switch to check which subclass of Shape are we dealing with. If we add a new shape type, we need to make changes in every method in Geometry class. If we add a new operation type, we need to only add the new function to Geometry class.&nbsp;</blockquote><blockquote class="tr_bq">Instead, we could have each subclass of <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Shape]</span> have their own set of those methods - that would be exactly the OO style.</blockquote><br /><b>The Law of Demeter -&nbsp;</b>a module <b>should not&nbsp;know about the innards </b>of the objects it manipulates. A function can call operations on elements of an object <b>where it is declared</b>, but not on the objects <b>returned </b>by those operations.<br /><blockquote class="tr_bq">That is why the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[ctxt.getOptions().getScratchDir().getAbsolutePath()]</span> is a candidate of breaking that law. [BUT] <b>not </b>if the subsequent classes are <b>data structures </b>not <b>objects</b>.</blockquote><blockquote class="tr_bq">And, if they are objects, there should not be "getSth" functions on them, but "doSth" functions. If we need to get sth, let's think about what we need it for, and move that logic into that class, under a "doSth" function.</blockquote><b>Active Records&nbsp;</b>are DTOs with extra methods like <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[save()]</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[find()]</span>, e.g. for using with database. Treat them as <b>data structures </b>and don't add more logic.<br /><br /><h3 style="text-align: left;">6. Error Handling</h3><div>Write <i>try-catch-finally</i> blocks <b>first </b>- they define the <b>scope</b>, "transaction".<br /><br />Keep <b>error handling separate </b>from the business logic.<br /><br /><b>Unchecked exceptions are now fine</b>. In the past they were bad practice, now they are not. It's neccessity. Encouraging checked exceptions in Java was a <b>mistake</b>, as they violate OCP principle. Only use them if you write a critical library and need to force the user to catch an exception.<br /><br /><b>Classifying </b>yor exceptions - should be done according to <b>how they will be caught</b>. Use different classes for your exceptions only if there are times <b>you want catch one exception and let go the other</b>.</div><br /><b>Special case </b>pattern (by Fowler) - when you feel like you want to steer your logic using <b>exceptions </b>- return a <b>special</b>, "exceptional" object instead of throwing an exception, and let the further code treat it as if is was a valid response - without knowing that it is a special case object. Sometimes this pays off.<br /><br />Don't return <b>null</b>. This forces you to write a lot of null checks, and of course one day you will forget one.<br /><br />Don't pass <b>null (</b>like <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[calculator.xProjection(null, new Point(12, 13));]</span>).<br /><br /><h3 style="text-align: left;">7. Boundaries</h3>Sometimes it's a good idea to <b>encapsulate</b> <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Map&lt;String, Integer&gt;]</span> into own object, so that the user does not see the generics. Don't pass <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Map</span>s or other <b>boundary interfaces </b>(i.e. coming from 3rd party general use library)<b>&nbsp;</b>around your system. They should not be part of your public API.<br /><br /><b>Learning tests</b> - if you learn a 3rd party library, write tests that reflect your understanding. Will be helpful for others to understand and will immediately <b>detect backward incompatibility</b> when updating to newer version.<br /><br /><b>Boundary tests</b> - similat to the above, but focus <b>only on the parts used by our software</b>.<br /><br />When you want to <b>integrate </b>sth that is <b>not yet implemented </b>- feel free to write the <b>interface </b>yourself, and later just <b>add an adapter</b>.<br /><br />What happens at <b>boundaries </b>is <b>change</b>. <b>Minimize </b>the number of <b>touch points </b>with 3rd party libraries.<br /><br /><h3 style="text-align: left;">8. Unit Tests</h3>[Some well known rules about TDD]<br /><br />Use <b>same quality standards </b>for tests as for production code! Otherwise maintenance will become pain in the head. No "<i>quick and dirty</i>" tests! <b>Dirty tests are worse than no tests</b>. Below an illustration of a real life story:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-sPTePip1-4Y/VpfEAGRrCwI/AAAAAAAACVE/f634aJu_RYk/s1600/dirty%2Btests.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="226" src="https://1.bp.blogspot.com/-sPTePip1-4Y/VpfEAGRrCwI/AAAAAAAACVE/f634aJu_RYk/s320/dirty%2Btests.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">[my own visualisation of the story from the book]</td></tr></tbody></table>Tests keep the production code <b>flexible</b>.<br /><br /><b>Readability </b>in tests is even <b>more important </b>than it is in production code. So refactor, remove code duplication, choose descriptive names. Make it clear where the "setup", "run" and "assert" part is. <b>Design the tests for reading</b>.<br /><br />Even write a set of <b>utility methods </b>only for your tests, that will use <b>domain language</b>, and provide a <b>testing API</b> to your system.<br /><br />Keep on <b>refactoring tests</b>, just like you do with the production code.<br /><br />Test <b>one concept per test</b>. A test should have <b>only one reason </b>to fail.<br /><br /><b>Tests </b>should be <b>F.I.R.S.T.</b> - <b>fast</b>, <b>independent </b>from each other, <b>repeatable </b>(e.g. independent from the network), <b>self validating </b>(either pass or fail, no manual steps in between), <b>timely</b> (written on time, not after production code is done).<br /><br /><h3 style="text-align: left;">9. Classes</h3>If a <b>test </b>needs it, it's fine to change a method <b>from private to protected</b>, if no other solution.<br /><br />A class should be <b>smaller than small</b>. It should have <b>only one </b>responsibility.<br /><br /><i><b>Single Responsibility Principle&nbsp;</b>(SRP) states that a class or module should have&nbsp;<b>one, and only one, reason to change</b>.</i><br /><br /><b>Responsibility</b> = reason to change.<br /><br />If you have <b>problem with finding concise (unambigious) name </b>for the class, it is likely it has <b>too many responsibilities</b>. Especially names including <i>Manager</i>, <i>Processor</i>, or <i>Super</i>.<br /><br /><b>Making things work </b>and <b>keeping code clean </b>are two different activities that cannot be done simultaneously. So after you are done with the first,&nbsp;<b>don't forget the latter</b>!<br /><br />Don't be afraid of having <b>many small classes</b>. The complexity comes from number of <b>moving parts</b> not number of classes. You will not change program <b>complexity </b>by dividing it into many classes, but you will increase the ease with which someone else can <b>learn </b>it, and find the piece that is relevant to them at the moment. It's about <b>organising </b>the complexity.<br /><br /><b>Cohesion of a function</b> is proportional to the <b>number of instance variables&nbsp;</b>it modifies. The number of&nbsp;<b>instance variables&nbsp;</b>of a class should be&nbsp;<b>small </b>and <b>cohesion high</b>. And now listen to that:<br /><blockquote class="tr_bq">Often when you want to <b>minimize number of function arguments </b>and create <b>small functions</b>, the number of <b>instance variables grow</b>, and often also at the same time <b>cohesion decreases</b>. This is often the <b>sign </b>that <b>another class </b>tries to <b>get out of the bigger class</b>. Split them!</blockquote><br /><h3 style="text-align: left;">10. Systems</h3><div><b>Separate </b>system <b>startup code </b>from <b>the rest of the code </b>(initialization, etc.). Even avoid such <b>lazy initialization</b> (it introduces&nbsp;<b>coupling</b>):<br /><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[public Service getService() {</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;if (service == null)</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp;service = new MyServiceImpl(...);&nbsp;</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;return service;</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}]</span></blockquote>Keeping <b>modularity </b>is <b>more important </b>than <b>convenience</b>! As a solution you can: move all initialization logic to <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[main]</span>, use <b>Abstract&nbsp;Factories,</b>&nbsp;or use <b>dependency injection </b>(Spring).<br /><br />Right <b>separation of concerns </b>- allows us to build systems <b>incrementally</b>, we don't have to get it all right from the start. EJB1 and EJB2 is an example of <b>bad separation of concerns </b>(everything coupled to the container).</div><br /><b>Aspects </b>and <b>proxies </b>are an attempt used for separating <b>cross cutting concerns</b>, <b>proxies </b>have some <b>drawbacks </b>though (though Spring makes them <b>transparent enough </b>to be acceptable). Aspect like architecture enables it to be <b>test-driven</b>.<br /><br />Always <b>postpone </b>architectural decisions to the <b>last possible moment</b>.<br /><br />Don't <b>blindly </b>follow emerging standards or hypes.<br /><br /><h3 style="text-align: left;">11. Emergence</h3><div><b>Emergent design</b>.</div><div><br /></div><div>Rules of <b>good design </b>(by Kent Beck):</div><div><ul style="text-align: left;"><li>Runs <b>all tests </b>(i.e. passes them)</li><li>Contains <b>no duplication</b></li><li>Expresses the <b>intent </b>of the programmer</li><li><b>Minimizes </b>the number of classes and methods</li></ul><br /><ul style="text-align: left;"></ul></div><h3>12. Concurrency</h3><div>Concurrency is a <b>decoupling strategy</b>: it helps us decouple <b>what </b>gets done from <b>when </b>it gets done.<br /><br />Concurrency does <b>not always </b>improve <b>performance</b>.<br /><br />Concurrency requires&nbsp;fundamental <b>change in design strategy</b>.<br /><br /><b>Corrent </b>concurrency is <b>complex </b>even for <b>simple </b>problems. <b>Bugs </b>are often <b>not repeatable</b>, therefore often incorrectly ignored.<br /><br />Keep your concurrency code <b>separate </b>from other code.<br /><br /><b>Limit </b>the places where a variable is accessed concurrently to <b>minimum</b>. Eventually you will forget to synchronize the access in one place.</div><br />If you can introduce <b>immutable </b>objects <b>instead of synchronizing</b>, do so. It's <b>worth </b>the garbage collection overhead.<br /><br />Try to <b>partition </b>your data in such a way that it can be used by <b>independent </b>threads.<br /><br />Use &nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[java.util.concurrent.*]</span> <b>collections </b>instead of regular ones. <b>In particular</b>, you should use <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[ConcurrentHashMap]</span> instead of <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[HashMap]</span> <b>always</b>, as it is more performant in general.<br /><br /><b>Become familiar </b>with <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[java.util.concurrent.*]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[java.util.concurrent.atomic.*]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[java.util.concurrent.locks.*]</span>, e.g. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[ReentrantLock]</span> - can be acquired in one method and released in another, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Semaphore]</span> - lock with a count, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[CountDownLatch]</span> - releases all threads after receiving a number of events.<br /><br /><b>Become familiar </b>with concurrent <b>execution models</b>:<br /><ul style="text-align: left;"><li><b>producer-consumer </b>- and a queue between, as a <i>bound resource </i>(limited capacity). They have to signal each other, and wait for the signal from another before doing anything.</li><li><b>readers-writers </b>- where readers read more often than writers write. Writers could wait for all readers to finish before they write, but they will <i>starve </i>in case of continuous readers. A balance needs to be found.</li><li><b>dining philosophers </b>- in other words processes competing for resources.</li></ul><div>Most concurrency problems are <b>combination </b>of the three above. <b>Learn </b>the three above and their <b>solutions</b>.</div><div><br /></div><div>Keep number of&nbsp;<b>synchronized </b>sections <b>low, </b>but also keep those sections <b>as&nbsp;small as possible</b>.</div><div><br /></div><div>Writing correct <b>shut-down </b>is <b>harder than you think</b>. Plan enough <b>time </b>for that.</div><div><br /></div><div><b>Testing concurrent code </b>does not assure its <b>correctness</b>. But it can <b>minimize its incorrectness</b>. Write your tests very varied, with different parameters, try to cover extreme cases. <b>Never </b>ignore a situation when a test failed just once. Remember that the <b>number of possibilities </b>of concurrent execution of <b>trivally simple </b>code is <b>huge</b>. Chase every bug.</div><div><br /></div><div>Make sure your code works <b>outside of threads </b>first.</div><div><br /></div><div>Make your <b>threaded code pluggable </b>and <b>tunable</b>, so that you can test it <b>independently</b>.</div><div><br /></div><div>Test your threaded code with <b>more threads than processors</b>. Things happen when the <b>system switches between </b>the tasks.</div><div><br /></div><div>Test your code on <b>different platforms</b> (they have different task switching strategies).</div><div><br /></div><div>Add <b>random </b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><b>[</b>Object.wait()]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Object.sleep()]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Object.yield()]</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Object.priority()]</span> in your code, to <b>increase possibility of failure</b>. You can automate it by writting an utility class doing that, and then adding an aspect randomly enabling it or disabling at any method call. There is an example library doing that: https://www.research.ibm.com/haifa/projects/verification/contest/.</div><div><br /></div><div><div>Avoid calling <b>one locked section from another</b>.</div></div><br /><h3 style="text-align: left;">13. Successive Refinement</h3><div>There is a long use case presented. To sum it up: code may be quite nice and clean initially, but once we add new functionality it can become a monster. Always <b>refactor </b>and <b>clean up</b>. But <b>not before </b>you have <b>tests</b>. Use <b>TDD while refactoring</b>.</div><div><br /></div><div><div><i>Programmers who satisfy themselves with merely working code are behaving unprofessionally.</i></div></div><div><br /></div><h3 style="text-align: left;">14. JUnit Internals</h3>[Another use case]<br /><br /><h3 style="text-align: left;">15. Refactoring <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">SerialDate</span></h3>[Another use case]<br /><br /><h3>16.&nbsp;Smells and Heuristics</h3><div>[Set of numbered checks with explanations. I write only the new things.]</div><div><br /><b>Comments</b><br /><ul style="text-align: left;"><li><b>inappriopriate information</b> - when the information should rather be <b>somewhere else </b>(issue tracking system, source control)</li><li><b>obsolete </b>comment - outdated</li><li><b>redundant </b>comment - as it is clear from the code</li><li><b>poorly written </b>comment</li><li><b>commented out code</b></li></ul><div><b>General</b></div><div><ul style="text-align: left;"><li><b>multiple languages </b>in one source file</li><li><b>corner cases </b>not handled (and tests missing)</li><li>code at <b>wrong level of abstraction </b>(e.g. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[pop()]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[push()]</span>, and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[percentFull()]</span> in one <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[Stack]</span> class)</li><li><b>base classes </b>depending on their <b>derivatives</b></li><li><b>too many functions </b>in an <b>interface</b></li><li><b>feature envy </b>- a function tries to read or modify variables of another class than its <b>owner </b>(though sometimes it may be neccessary)</li><li>function with a <b>boolean </b>input (should be <b>2 functions </b>instead)</li><li><b>misplaced responsibility </b>- code should be where the reader <b>expects it to be, </b>not where it is <b>convenient </b>for us</li><li><b>inappropriate static</b> - if we make a function <b>static </b>it means we do not expect that it is ever polymorphic; e.g. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[HourlyPaidCalculator.calculatePay(employee, overtimeRate)]</span> is not really clean</li><li>use <b>intermediate variables </b>- because they can have <b>descriptive names</b></li><li><b>understand </b>an algorithm <b>before implementing it</b>; don't rely on <b>try-error </b>method; don't assume that a function works because it passes all the tests if you don't <b>understand </b>it; if you have problems understanding it - <b>refactor it </b>to become more obvious</li><li>make <b>logical dependencies physical</b> (e.g. placing a constant in one place with a value that needs to match another value somewhere else is not a good idea)</li><li>make <b>temporal coupling </b>visible</li></ul><div><b>Java</b></div></div><div><ul style="text-align: left;"><li>[nothing new]</li></ul><div><b>Names</b></div></div><div><ul style="text-align: left;"><li>choose names <b>appropriate to current level of abstraction</b> (i.e. general enough to cover all cases), e.g. <i>connectionLocator </i>instead of <i>phoneNumber</i></li><li>the&nbsp;<b>length&nbsp;of a&nbsp;variable&nbsp;name </b>should be prortional to the <b>scope </b>of the&nbsp;variable - for example loop counter is usually one character long and it's better than a loger name</li></ul><div><b>Tests</b></div></div><div><ul style="text-align: left;"><li>use <b>test coverage </b>tool</li><li>don't skip <b>trivial </b>tests</li><li>test <b>corner cases</b></li><li>test exhaustively <b>around found bugs </b>- they often hang out in <b>groups</b> :P</li><li>keep your tests <b>fast </b>(so that you want to run them)</li></ul></div></div><h3 style="text-align: left;">17. Appendix A: Concurrency II</h3><div>[I'll just write some selected stuff]<br /><br />It's a common <b>misconception </b>that <b>increment operation</b> ++ is <b>atomic</b>. <b>Assigment </b>is usually also not. Something like 8 steps can be involved in single assignment on the level of <b>byte code</b>, hence so many possible paths of execution in a multithreaded environment.<br /><blockquote class="tr_bq">That's why <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[<b>AtomicInteger</b>]</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[<b>AtomicReference</b>]</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[<b>AtomicBoolean</b>]</span> are there since Java 5. They are <b>not slower </b>(because of special CAS feature of modern processors, which basically means that instead of locking, it just retries until it succeeds).</blockquote><b>Nonthread-safe </b>classes:<br /><ul style="text-align: left;"><li>SimpleDateFormat</li><li>Database Connections</li><li>Containers in java.util.*</li><li>Servlets</li></ul><div>Example of something <b>not being thread safe </b>even though each method <b>separately </b>is; assume that&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[hasNext()]</span>&nbsp;and&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[next()]</span>&nbsp;are both <b>synchronized</b>:</div><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[if (myThreadSafeIterator.hasNext()){</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;process(myThreadSafeIterator.next());</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}]</span></blockquote>- between <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[hasNext()]</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[next()]</span>&nbsp;there is a <b>break</b>, and if this code is executed in &gt;1 thread, the threads can interleave exactly here, and cause one thread to go beyond the iterator.<br /><b><br /></b><b>Solutions</b>:<br /><ul style="text-align: left;"><li>wrap the whole code block into another <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[synchronized(myThreadSafeIterator)]</span> block (extract the call to "process" beyond it, to keep it as short as possible). This is&nbsp;<b>client-based locking</b>. Not very reliable solution (someone may forget to add this).</li><li>change the design of iterator, by merging both methods into one, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[getNextOrNull()]</span>. This is <b>server-side locking</b>. Trivial isn't it. If you cannot change the server side code, e.g. because it is a 3rd party library, <b>add an adapter</b>&nbsp;...or use another library :P</li></ul><div>Book recommendation: <i>Doug Lea "Concurrent Programming in Java: Design Principles and Patterns"</i>.</div></div><h3 style="text-align: left;">18.&nbsp;Appendix B: org.jfree.date.SerialDate</h3>[Just full source code for the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">SerialDate</span><span style="font-family: inherit;"> </span>use case]<br /><br /></div>
